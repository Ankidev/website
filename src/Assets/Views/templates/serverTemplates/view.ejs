<%- include("../../partials/header.ejs") %>
<link href="/css/listing.css?v=<%= cssVersion %>" type="text/css" media="screen, print" rel="stylesheet" />
<script src="https://code.jquery.com/jquery-3.4.1.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BreadcrumbList",
        "itemListElement": [
            {
                "@type": "ListItem",
                "position": 1,
                "name": "Home",
                "item": "https://discordextremelist.xyz/"
            },
            {
                "@type": "ListItem",
                "position": 2,
                "name": "Templates",
                "item": "https://discordextremelist.xyz/templates"
            },
            {
                "@type": "ListItem",
                "position": 2,
                "name": "<%= template.name %>",
                "item": "https://discordextremelist.xyz/templates/<%= template._id %>"
            }
        ]
    }
</script>
<%
    let defaultColour = "#b114ff";
    let foreground = "#ffffff";

    if (req.user) {
        defaultColour = req.user.db.preferences.defaultColour || "#b114ff"
        foreground = req.user.db.preferences.defaultForegroundColour || "#ffffff"
    }
%>
<%- include("../../partials/nav.ejs") %>
<style type="text/css">.tag:not(body).is-default{background-color:<%= defaultColour %>;color:<%= foreground %>}</style>
<section class="hero is-primary">
    <div class="hero-body">
        <div class="container">
            <br />
            <div class="columns">
                <div class="column is-2">
                    <img class="image" title="<%= template.name %>'s Icon'" style="<% if (mobile) { %>display: block; margin-left: auto; margin-right: auto;<% } %> border-radius: 50%;" src="<%= template.icon.url %>.<%= imageFormat %>?size=128" alt="<%= template.name %>'s Icon" onerror="this.onerror = null;this.src = '/img/defaultavatar.<%= imageFormat %>';console.log('Failed to load item\'s avatar/icon, using default instead.');" draggable="false">
                </div>
                <div class="column is-10">
                    <h1 class="is-size-1">
                        <span id="templateName"><%= template.name %></span>
                    </h1>
                    <h2 class="subtitle"><%= template.shortDesc %></h2>
                    <% if (req.user) { %>
                        <div class="buttons <% if (mobile) { %>is-centered<% } %>">
                            <% if (template.owner.id === req.user.id) { %>
                                <a href="<%= linkPrefix %>/templates/<%= template._id %>/edit" class="button is-dark">
                                    <span class="icon">
                                        <i aria-hidden="true" class="fas fa-pencil"></i>
                                    </span>
                                    <span><%= __("common.edit") %></span>
                                </a>
                                <a href="" id="deleteModal" class="button is-dark">
                                    <span class="icon">
                                        <i aria-hidden="true" class="fas fa-trash"></i>
                                    </span>
                                    <span><%= __("common.delete") %></span>
                                </a>
                            <% } %>
                            <% if (user.db.rank.mod && template.owner.id !== req.user.id) { %>
                                <div class="dropdown">
                                    <div class="dropdown-trigger">
                                        <button class="button is-dark" aria-haspopup="true" aria-controls="dropdown-ui-actions">
                                            <span class="icon">
                                                <i aria-hidden="true" class="fas fa-cogs" aria-hidden="true"></i>
                                            </span>
                                            <span><%= __("common.staffManagement") %></span>
                                            <span class="icon is-small">
                                                <i aria-hidden="true" class="fas fa-angle-down" aria-hidden="true"></i>
                                            </span>
                                        </button>
                                    </div>
                                    <div class="dropdown-menu" id="dropdown-ui-actions" role="menu">
                                        <div class="dropdown-content">
                                            <div class="dropdown-item">
                                                <p class="has-text-danger"><%= __("common.staffManagement.warning") %></p>
                                            </div>
                                            <hr class="dropdown-divider">
                                            <a class="dropdown-item" href="<%= linkPrefix %>/templates/<%= template._id %>/edit">
                                                <span class="icon"><i aria-hidden="true" class="fas fa-pencil"></i></span>
                                                <span><%= __("common.edit") %></span>
                                            </a>
                                            <a class="dropdown-item" href="<%= linkPrefix %>/templates/<%= template._id %>/remove">
                                                <span class="icon"><i aria-hidden="true" class="fas fa-trash"></i></span>
                                                <span><%= __("common.staff.remove") %></span>
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            <% } %> 
                        </div>
                    <% } %>
                    <div class="buttons <% if (mobile) { %>is-centered<% } %>">
                        <a target="_blank" href="<%= template.links.template %>" class="button is-link">
                            <span class="icon">
                                <i aria-hidden="true" class="fas fa-clone"></i>
                            </span>
                            <span><%= __("page.templates.useTemplate") %></span>
                        </a>
                    </div>
                    <div class="field is-grouped is-grouped-multiline <% if (mobile) { %>is-grouped-centered<% } %>">
                        <div class="control">
                            <div class="tags has-addons">
                                <span class="tag is-dark"><%= __("common.listingOwner") %></span>
                                <span class="tag is-link"><a class="has-text-white" href="<%= linkPrefix %>/users/<%= template.owner.id %>"><%= templateOwner.fullUsername %></a></span>
                            </div>
                        </div>
                        <div class="control">
                            <div class="tags has-addons">
                                <span class="tag is-dark"><%= __("page.templates.used") %></span>
                                <span class="tag is-info"><%= __("page.templates.used.times", template.usageCount) %></span>
                            </div>
                        </div>
                    </div>
                    <% if (template.tags && template.tags.length > 0) { %>
                        <div class="field is-grouped is-grouped-multiline <% if (mobile) { %>is-grouped-centered<% } %>">
                            <%- template.tags.map(tag => include("../../partials/tag.ejs", { tag })).join("") %>
                        </div>
                    <% } %>
                </div>
            </div>
        </div>
    </div>
</section> 
<div class="container" style="overflow: hidden;">
    <br />
    <div class="column is-12 tabs is-boxed">
        <ul>
            <li class="is-active">
                <a>
                <span class="icon is-small">
                    <i class="fas fa-align-center" aria-hidden="true"></i>
                </span>
                <span><%= __("common.description") %></span>
            </a>
            </li>
            <li>
                <a>
                    <span class="icon is-small">
                        <i class="fas fa-info-circle" aria-hidden="true"></i>
                    </span>
                    <span><%= __("page.templates.details") %></span>
                </a>
            </li>
        </ul>
        </div>
        <div class="column is-12 tabs-content">
            <div class="tab-content is-active content" style="white-space: pre;">
                <%- longDesc %>
            </div>
            <div class="tab-content">
                <div class="columns">
                    <div class="column is-one-third">
                        <div class="columnBody infoColumn">
                            <h4 class="is-size-4"><%= __("page.templates.channels") %></h4>
                            <div id="collapsibleBody1">
                                <div id="channelList">
                                    <%- template.channels.map(channel => include("../../partials/channels.ejs", { channel })).join("") %>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="column is-one-third">
                        <div class="columnBody infoColumn">
                            <h4 class="is-size-4"><%= __("page.templates.roles") %></h4>
                            <div id="collapsibleBody2">
                                <div id="channelList">
                                    <%- template.roles.reverse().filter(r => r.name !== '@everyone').map(role => include("../../partials/roles.ejs", { role })).join("") %>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="column is-one-third">
                        <div class="columnBody infoColumn">
                            <h4 class="is-size-4"><%= __("page.templates.otherInfo") %></h4>
                            <div id="collapsibleBody3">
                                <div id="otherInfo">
                                    <p><strong><%= __("page.templates.otherInfo.region") %></strong> <img src="https://discord.com/assets/<%= functions.regionIcon(template.region) %>.png" alt="" style="height: 1em; vertical-align: middle"> <%= functions.parseRegion(template.region) %></p>
                                    <p><strong><%= __("page.templates.otherInfo.afkTimeout") %></strong> <%= Math.floor(template.afkTimeout / 60) %>m</p>
                                    <%- include("../../partials/verificationLevel.ejs") %>
                                    <%- include("../../partials/msgNotifications.ejs") %>
                                    <%- include("../../partials/explicitFilter.ejs") %>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="modal deleteModal">
    <div class="modal-background"></div>
    <div class="modal-card">
        <header class="modal-card-head">
            <p class="modal-card-title has-text-danger"><%= __("common.warning") %></p>
        </header>
        <section class="modal-card-body has-text-danger">
            <%= __("page.templates.warning.delete") %>
        </section>
        <footer class="modal-card-foot">
            <div class="buttons">
                <a class="button is-success" href="<%= linkPrefix %>/templates/<%= template._id %>/delete">
                    <span class="icon">
                        <i aria-hidden="true" class="fas fa-check-circle"></i>
                    </span>
                    <span><%= __("common.delete") %></span>
                </a>
                <button class="button is-danger" id="close-modal">
                    <span class="icon">
                        <i aria-hidden="true" class="fas fa-times-circle"></i>
                    </span>
                    <span><%= __("common.cancel") %></span>
                </button>
            </div>
        </footer>
    </div>
    <script type="text/javascript">document.querySelector("a#deleteModal").addEventListener("click",function(event){event.preventDefault();const modal=document.querySelector(".deleteModal");const html=document.querySelector("html");modal.classList.add("is-active");html.classList.add("is-clipped");modal.querySelector(".modal-background").addEventListener("click",function(e){e.preventDefault();modal.classList.remove("is-active");html.classList.remove("is-clipped")});document.querySelector("button#close-modal").addEventListener("click",function(e){e.preventDefault();modal.classList.remove("is-active");html.classList.remove("is-clipped")})})</script>
</div>
<% if (mobile) { %>
    <style>#collapsibleBody1, #collapsibleBody2, #collapsibleBody3 { display: none }</style>
    <script>
        
    </script>
<% } %>
<script type="text/javascript">const dropdowns=document.querySelectorAll(".dropdown:not(.is-hoverable)");function closeDropdowns(){dropdowns.forEach(function(o){o.classList.remove("is-active")})}dropdowns.length>0&&(dropdowns.forEach(function(o){o.addEventListener("click",function(n){n.stopPropagation(),o.classList.toggle("is-active")})}),document.addEventListener("click",function(o){closeDropdowns()})),document.addEventListener("keydown",function(o){let n=o||window.event;"Esc"!==n.key&&"Escape"!==n.key||closeDropdowns()});</script>
<script type="text/javascript">$(".tabs").each(function(index){var $tabParent=$(this);var $tabs=$tabParent.find("li");var $contents=$tabParent.next(".tabs-content").find(".tab-content");$tabs.click(function(){var curIndex=$(this).index();$tabs.removeClass("is-active");$tabs.eq(curIndex).addClass("is-active");$contents.removeClass("is-active");$contents.eq(curIndex).addClass("is-active")})});</script>
<%- include("../../partials/footer.ejs") %>
